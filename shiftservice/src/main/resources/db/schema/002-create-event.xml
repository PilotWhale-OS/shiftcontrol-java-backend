<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

  <changeSet id="002-create-event" author="paul">

    <createTable tableName="event">

      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"/>
      </column>

      <column name="name" type="VARCHAR(255)">
        <constraints nullable="false" unique="true"/>
      </column>

      <column name="short_description" type="VARCHAR(255)">
        <constraints nullable="true"/>
      </column>

      <column name="long_description" type="VARCHAR(1024)">
        <constraints nullable="true"/>
      </column>

      <column name="start_time" type="TIMESTAMP">
        <constraints nullable="false"/>
      </column>

      <column name="end_time" type="TIMESTAMP">
        <constraints nullable="false"/>
      </column>

    </createTable>

  </changeSet>
  <changeSet id="100-event-social-media-links" author="marco">
    <createTable tableName="event_social_media_link">
      <column name="id" type="BIGINT" autoIncrement="true">
        <constraints primaryKey="true" nullable="false"
                     primaryKeyName="pk_event_social_media_link"/>
      </column>

      <column name="event_id" type="BIGINT">
        <constraints nullable="false"
                     foreignKeyName="fk_event_social_media_link_event"
                     referencedTableName="event"
                     referencedColumnNames="id"/>
      </column>

      <column name="type" type="VARCHAR(50)">
        <constraints nullable="false"/>
      </column>

      <column name="url" type="VARCHAR(1024)">
        <constraints nullable="false"/>
      </column>
    </createTable>

    <createIndex
      tableName="event_social_media_link"
      indexName="idx_event_social_media_link_event_id">
      <column name="event_id"/>
    </createIndex>

    <addUniqueConstraint
      tableName="event_social_media_link"
      columnNames="event_id, type, url"
      constraintName="uq_event_social_media_link_event_type_url"/>
  </changeSet>

</databaseChangeLog>
